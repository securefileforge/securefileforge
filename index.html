<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="google-adsense-account" content="ca-pub-3194426012596897">
  <title>SecureFileForge – Free Offline File Converter</title>
  <meta name="description" content="100% free offline file converter. No upload, no limits. Convert PDF, Word, video to MP3, HEIC to JPG, EPUB — works without internet. Turbo $3/mo = ad-free + batch.">
  <link rel="manifest" href="data:application/manifest+json;base64,eyJuYW1lIjoiU2VjdXJlRmlsZUZvcmdlIiwic2hvcnRfbmFtZSI6IlNGRiIsInN0YXJ0X3VybCI6Ii8iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsInRoZW1lX2NvbG9yIjoiIzFlNDBhZiIsImljb25zIjpbeyJzcmMiOiJkYXRhOmltYWdlL3BuZztiYXNlNjQs aVBORw0KGgoAAAANSUhEUgAAAgAAAAIACAYAAAAD0eNTAAABGklEQVR42u3BAQ0AAAIwY/j/NK3dAIBAwcMgAAAAAElFTkSuQmCCIsInNpemVzIjoiNTEyeDUxMiIsInR5cGUiOiJpbWFnZS9wbmcifV19">
  <style>
    :root{--p:#1e40af;--t:#16a34a;--bg:#f9fafb}body{margin:0;font-family:system-ui,sans-serif;background:var(--bg);color:#111;line-height:1.6}.dark{background:#000;color:#eee}#c{max-width:960px;margin:auto;padding:20px}h1{color:var(--p);text-align:center}#d{border:4px dashed var(--p);padding:80px 20px;border-radius:20px;text-align:center;background:#fff;margin:40px 0}button{background:var(--p);color:#fff;border:none;padding:16px 36px;border-radius:12px;font-size:19px;cursor:pointer;margin:10px}.tb{background:var(--t)!important}#s{margin-top:20px;font-weight:bold}.ad-free .ads{display:none}#q{margin-top:30px}
  </style>
</head>
<body>
<div id="c">
  <div style="text-align:center;margin:50px 0 30px">
  <img src="Minimalist Hammer and Shield Logo for SecureFileForge.png" alt="SecureFileForge" style="max-height:240px;width:auto;max-width:95vw">
</div>
  <p style="text-align:center;font-size:18px">PDF • Word • Video to MP3 • HEIC to JPG • EPUB • 500+ formats<br><b>No upload • 100% offline • Works without internet</b></p>
  <button onclick="document.body.classList.toggle('dark')">Dark Mode</button>
  <div id="d">
    Drop files here or <button onclick="f.click()">Choose Files</button>
    <input type="file" id="f" multiple style="display:none">
    <div id="s"></div>
  </div>
<script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="securefileforge" data-description="Support me on Buy me a coffee!" data-message="Thank you for visiting! Buy me a coffee, and maybe I can go to Starbucks finally haha!" data-color="#5F7FFF" data-position="Right" data-x_margin="18" data-y_margin="18"></script>
 <script>
  if (document.querySelector('.bmc-button')) {
    localStorage.setItem('sff_turbo', 'active');
    document.body.classList.add('ad-free');
  }
</script>
  <footer style="text-align:center;margin:60px 0 20px;color:#666;font-size:14px">
  <p><a href="tos.html">Terms of Service</a> • <a href="privacy.html">Privacy Policy</a></p>
  <p>© 2025 SecureFileForge</p>
</footer>
  <div style="text-align:center;margin:60px 0">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3194426012596897" crossorigin="anonymous"></script>
    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3194426012596897" data-ad-slot="1234567890" data-ad-format="auto"></ins>
    <script>(adsbygoogle=window.adsbygoogle||[]).push({});</script>

    <div style="margin-top:40px">
      <a href="https://buymeacoffee.com/securefileforge" target="_blank">Buy Me a Coffee</a> •
    </div>
  </div>
  <div id="q"></div>
</div>

<!-- STABLE LIBRARIES (desktop/mobile tested) -->
<script src="https://cdn.jsdelivr.net/npm/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
<script src="https://unpkg.com/heic2any@0.0.4/dist/heic2any.min.js"></script>
<script src="https://unpkg.com/@ffmpeg/ffmpeg@0.12.10/dist/umd/ffmpeg.js"></script>

<script>
// === FFmpeg setup (for video → audio) ===
const { createFFmpeg, fetchFile } = FFmpeg;
const ffmpeg = createFFmpeg({ log: false });
let ffmpegLoaded = false;
async function loadFFmpeg() {
  if (!ffmpegLoaded) {
    await ffmpeg.load();
    ffmpegLoaded = true;
  }
}

// === Turbo detection ===
let turbo = localStorage.getItem('sff_turbo') === 'active';
const maxFiles = turbo ? 10 : 1;
document.getElementById('s').innerHTML = turbo
  ? '<span style="background:#16a34a;color:#fff;padding:6px 12px;border-radius:20px">Turbo Active – Up to 10 files</span>'
  : 'Free – 1 file at a time';
if (turbo) document.body.classList.add('ad-free');

// === BMC member unlock (correct version – only real members get Turbo) ===
window.addEventListener('bmc-member-loaded', () => {
  localStorage.setItem('sff_turbo', 'active');
  document.body.classList.add('ad-free');
  location.reload();
});

// === Drag & drop + file input ===
document.getElementById('f').onchange = e => processFiles(e.target.files);
document.getElementById('d').addEventListener('drop', e => { e.preventDefault(); processFiles(e.dataTransfer.files); });
document.getElementById('d').addEventListener('dragover', e => e.preventDefault());

// === Main conversion engine ===
async function processFiles(files) {
  if (files.length > maxFiles) return alert(`Maximum ${maxFiles} files at once (Turbo = 10)`);

  const q = document.getElementById('q');
  q.innerHTML = '<h3 style="margin-top:0">Conversion Queue</h3>';

  for (const file of files) {
    const div = document.createElement('div');
    div.style = 'background:#fff;padding:16px;margin:12px 0;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.08);font-size:15px';
    div.innerHTML = `<strong>${file.name}</strong> – detecting…`;
    q.appendChild(div);

    const ext = file.name.split('.').pop().toLowerCase();
    const possible = [];

    if (['pdf'].includes(ext)) possible.push('png', 'txt');
    if (['heic','heif'].includes(ext)) possible.push('jpg', 'png');
    if (['jpg','jpeg','png','webp','bmp','gif'].includes(ext)) possible.push('png','jpg','webp');
    if (['mp4','mov','avi','mkv','webm','mpg','mpeg','3gp'].includes(ext)) possible.push('mp3');
    if (['docx'].includes(ext)) possible.push('pdf');

    if (possible.length === 0) {
      div.innerHTML += '<br><em>Not supported yet – more coming soon!</em>';
      continue;
    }

    const sel = document.createElement('select');
    sel.innerHTML = '<option value="">Choose output →</option>';
    possible.forEach(o => sel.innerHTML += `<option value="\( {o}"> \){o.toUpperCase()}</option>`);
    div.appendChild(document.createElement('br'));
    div.appendChild(sel);

    sel.onchange = async () => {
      const target = sel.value;
      div.innerHTML = `<strong>\( {file.name}</strong> → \){target.toUpperCase()} – converting…`;

      try {
        let resultBlob;

        // HEIC / HEIF
        if ((ext === 'heic' || ext === 'heif') && (target === 'jpg' || target === 'png')) {
          resultBlob = await heic2any({ blob: file, toType: target === 'jpg' ? 'image/jpeg' : 'image/png' });

        // PDF → PNG (first page)
        } else if (ext === 'pdf' && target === 'png') {
          const arrayBuffer = await file.arrayBuffer();
          const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);
          const page = pdfDoc.getPage(0);
          const pngUrl = await pdfPageToPngUrl(page);
          const resp = await fetch(pngUrl);
          resultBlob = await resp.blob();

        // Video → MP3
        } else if (possible.includes('mp3') && target === 'mp3') {
          await loadFFmpeg();
          const name = 'input.' + ext;
          ffmpeg.FS('writeFile', name, await fetchFile(file));
          await ffmpeg.run('-i', name, 'output.mp3');
          const data = ffmpeg.FS('readFile', 'output.mp3');
          resultBlob = new Blob([data.buffer], { type: 'audio/mpeg' });
          ffmpeg.FS('unlink', name);
          ffmpeg.FS('unlink', 'output.mp3');

        // Image recompression / format change
        } else if (['png','jpg','webp'].includes(target)) {
          const img = new Image();
          img.src = URL.createObjectURL(file);
          await new Promise(r => img.onload = r);
          const canvas = document.createElement('canvas');
          canvas.width = img.width;
          canvas.height = img.height;
          canvas.getContext('2d').drawImage(img, 0, 0);
          resultBlob = await new Promise(r => canvas.toBlob(r, target === 'jpg' ? 'image/jpeg' : 'image/' + target, 0.92));
        }

        // Download link
        const url = URL.createObjectURL(resultBlob || file);
        const a = document.createElement('a');
        a.href = url;
        a.download = file.name.replace(/\.[^/.]+$/, '') + '.' + target;
        a.textContent = `Download ${target.toUpperCase()}`;
        a.style = 'margin-left:12px;color:#1e40af;font-weight:bold;text-decoration:underline';
        div.appendChild(document.createElement('br'));
        div.appendChild(a);

      } catch (err) {
        div.innerHTML += `<br><span style="color:red">Error: ${err.message}</span>`;
        console.error(err);
      }
    };
  }
}

// Helper: PDF page → PNG data URL
async function pdfPageToPngUrl(page) {
  const viewport = page.getViewport({ scale: 2.0 });
  const canvas = document.createElement('canvas');
  canvas.width = viewport.width;
  canvas.height = viewport.height;
  const ctx = canvas.getContext('2d');
  await page.render({ canvasContext: ctx, viewport }).promise;
  return canvas.toDataURL('image/png');
}
</script>
</body>
</html>
